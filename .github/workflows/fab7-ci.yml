name: FAB7 CI

defaults:
  run:
shell: pwsh
on:
  workflow_dispatch:
  pull_request:
    branches: [ main ]
jobs:
  lint_and_smoke:
    runs-on: windows-latest
    steps:
      - name: Setup Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Whitespace/EOL check (diff-only, non-fatal)
        shell: pwsh
        run: |
          git fetch origin ${{ github.base_ref }} --depth=1
          git --no-pager diff --check origin/${{ github.base_ref }}...HEAD; exit 0
      - name: UXLegal advisory lint (diff-only + waivers)
        shell: pwsh
        run: pwsh -NoLogo -File policy/uxlegal/ci_lint.ps1
      - name: Sandbox smoke
        shell: pwsh
        run: pwsh -NoLogo -File sandbox/harness/smoke.ps1
      - name: Scenario DSL runner (Nash + others)
        shell: pwsh
        run: pwsh -NoLogo -File sandbox/harness/run_scenarios.ps1
      - name: Capture Step Summary
        if: always()
        shell: pwsh
        run: |
          if (Test-Path \) {
            Copy-Item -LiteralPath \ -Destination scenario-summary.md -Force
          } else {
            "" | Out-File -FilePath scenario-summary.md -Encoding utf8
          }
